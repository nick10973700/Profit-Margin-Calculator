<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ç”µå•†åˆ©æ¶¦è®¡ç®—å™¨ Pro</title>
    <style>
        /* å®šä¹‰é¢œè‰²å˜é‡ï¼šæ—¥é—´æ¨¡å¼ */
        :root {
            --primary-color: #3b82f6;
            --success-color: #16a34a;
            --danger-color: #ef4444;
            
            --bg-color: #f3f4f6;
            --card-bg: #ffffff;
            --input-bg: #f9fafb;
            --result-bg: #f1f5f9;
            
            --text-main: #1f2937;
            --text-sub: #6b7280;
            --border-color: #e5e7eb;
            --shadow: 0 10px 25px -5px rgba(0, 0, 0, 0.1), 0 8px 10px -6px rgba(0, 0, 0, 0.1);
        }

        /* å®šä¹‰é¢œè‰²å˜é‡ï¼šå¤œé—´æ¨¡å¼ */
        [data-theme="dark"] {
            --primary-color: #60a5fa;
            --success-color: #4ade80; /* å¤œé—´ç»¿è‰²æ›´äº®ä¸€ç‚¹ */
            --danger-color: #f87171;  /* å¤œé—´çº¢è‰²æ›´äº®ä¸€ç‚¹ */
            
            --bg-color: #111827;      /* æ·±ç°èƒŒæ™¯ */
            --card-bg: #1f2937;       /* å¡ç‰‡æ·±è‰² */
            --input-bg: #374151;      /* è¾“å…¥æ¡†æ·±è‰² */
            --result-bg: #111827;     /* ç»“æœåŒºåŸŸæ·±è‰² */
            
            --text-main: #f9fafb;     /* ç™½è‰²æ–‡å­— */
            --text-sub: #9ca3af;      /* æµ…ç°æ–‡å­— */
            --border-color: #374151;
            --shadow: 0 10px 25px -5px rgba(0, 0, 0, 0.5);
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", Arial, sans-serif;
            background-color: var(--bg-color);
            color: var(--text-main);
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
            margin: 0;
            padding: 20px;
            transition: background-color 0.3s, color 0.3s;
        }

        .container {
            background-color: var(--card-bg);
            width: 100%;
            max-width: 420px;
            padding: 30px;
            border-radius: 20px;
            box-shadow: var(--shadow);
            position: relative; /* ä¸ºäº†å®šä½åˆ‡æ¢æŒ‰é’® */
            transition: background-color 0.3s, box-shadow 0.3s;
        }

        /* ä¸»é¢˜åˆ‡æ¢æŒ‰é’® */
        .theme-toggle {
            position: absolute;
            top: 25px;
            right: 25px;
            background: none;
            border: none;
            cursor: pointer;
            font-size: 1.5rem;
            color: var(--text-main);
            padding: 5px;
            border-radius: 50%;
            transition: transform 0.2s, background-color 0.2s;
        }
        .theme-toggle:hover {
            background-color: var(--bg-color);
            transform: scale(1.1);
        }

        h1 {
            text-align: center;
            font-size: 1.5rem;
            margin-bottom: 25px;
            color: var(--text-main);
            font-weight: 700;
        }

        .section-label {
            font-size: 0.85rem;
            color: var(--text-sub);
            margin-bottom: 10px;
            font-weight: 600;
            display: block;
            margin-top: 15px;
            border-left: 3px solid var(--primary-color);
            padding-left: 8px;
        }

        .input-group {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 15px;
            margin-bottom: 10px;
        }

        .input-wrapper {
            position: relative;
        }

        label {
            display: block;
            font-size: 0.9rem;
            margin-bottom: 6px;
            color: var(--text-main);
            font-weight: 500;
            transition: color 0.3s;
        }

        input[type="number"] {
            width: 100%;
            padding: 12px 10px;
            font-size: 1.1rem;
            border: 1px solid var(--border-color);
            border-radius: 10px;
            box-sizing: border-box;
            transition: all 0.2s;
            background-color: var(--input-bg);
            color: var(--text-main);
            -moz-appearance: textfield;
        }
        
        input[type="number"]::-webkit-inner-spin-button, 
        input[type="number"]::-webkit-outer-spin-button { 
            -webkit-appearance: none; margin: 0; 
        }

        input[type="number"]:focus {
            outline: none;
            border-color: var(--primary-color);
            box-shadow: 0 0 0 3px rgba(59, 130, 246, 0.2);
        }

        /* ç»“æœåŒºåŸŸ */
        .result-card {
            background-color: var(--result-bg);
            border-radius: 15px;
            padding: 20px;
            margin-top: 25px;
            text-align: center;
            border: 1px solid var(--border-color);
            transition: transform 0.2s, background-color 0.3s, border-color 0.3s;
        }

        .main-profit {
            font-size: 2.5rem;
            font-weight: 800;
            margin: 10px 0;
            transition: color 0.3s;
        }
        
        .main-profit span {
            font-size: 1rem;
            font-weight: normal;
            color: var(--text-sub);
        }

        .sub-metrics {
            display: flex;
            justify-content: space-between;
            margin-top: 15px;
            border-top: 1px solid var(--border-color);
            padding-top: 15px;
        }

        .metric-item {
            text-align: center;
            flex: 1;
        }

        .metric-label {
            font-size: 0.8rem;
            color: var(--text-sub);
            margin-bottom: 4px;
        }

        .metric-value {
            font-size: 1.1rem;
            font-weight: 600;
            color: var(--text-main);
        }

        .btn-reset {
            width: 100%;
            padding: 12px;
            background-color: var(--card-bg);
            color: var(--text-sub);
            border: 1px solid var(--border-color);
            border-radius: 10px;
            margin-top: 20px;
            cursor: pointer;
            font-size: 0.9rem;
            transition: all 0.2s;
        }

        .btn-reset:hover {
            background-color: var(--bg-color);
            color: var(--text-main);
        }

        .text-green { color: var(--success-color) !important; }
        .text-red { color: var(--danger-color) !important; }

        /* åŠ¨ç”» */
        @keyframes pulse-green {
            0% { transform: scale(1); }
            50% { transform: scale(1.02); box-shadow: 0 0 15px rgba(22, 163, 74, 0.2); }
            100% { transform: scale(1); }
        }
        @keyframes pulse-red {
            0% { transform: scale(1); }
            50% { transform: scale(1.02); box-shadow: 0 0 15px rgba(220, 38, 38, 0.2); }
            100% { transform: scale(1); }
        }
        .pulse-green { animation: pulse-green 0.3s ease-in-out; }
        .pulse-red { animation: pulse-red 0.3s ease-in-out; }

    </style>
</head>
<body>

    <div class="container">
        <!-- ä¸»é¢˜åˆ‡æ¢æŒ‰é’® -->
        <button class="theme-toggle" id="themeBtn" onclick="toggleTheme()" title="åˆ‡æ¢æ—¥/å¤œæ¨¡å¼">
            â˜€ï¸
        </button>

        <h1>ğŸ’° è¿›è´§åˆ©æ¶¦è®¡ç®—å™¨</h1>

        <!-- ç¬¬ä¸€ç»„ï¼šæ ¸å¿ƒäº¤æ˜“æ•°æ® (å·²äº’æ¢ä½ç½®) -->
        <span class="section-label">æ ¸å¿ƒäº¤æ˜“æ•°æ®</span>
        <div class="input-group">
            <div class="input-wrapper">
                <label>è¿›è´§æˆæœ¬ (ä¹°å…¥)</label>
                <input type="number" id="cost" placeholder="0" inputmode="decimal">
            </div>
            <div class="input-wrapper">
                <label>å•†å“å®šä»· (å–å‡º)</label>
                <input type="number" id="price" placeholder="0" inputmode="decimal">
            </div>
        </div>

        <!-- ç¬¬äºŒç»„ï¼šç›¸å…³è´¹ç”¨ -->
        <span class="section-label">è¿è¥ä¸æ‚è´¹</span>
        <div class="input-group">
            <div class="input-wrapper">
                <label>å¿«é€’è¿è´¹</label>
                <input type="number" id="shipping" placeholder="0" inputmode="decimal">
            </div>
            <div class="input-wrapper">
                <label>åŒ…è£…æ‚è´¹</label>
                <input type="number" id="misc" placeholder="0" value="0" inputmode="decimal">
            </div>
        </div>
        <div class="input-wrapper">
            <label>å¹³å°/æ‰‹ç»­è´¹ç‡ (%)</label>
            <input type="number" id="feeRate" placeholder="ä¾‹å¦‚æ·˜å®å¡« 5" value="0" inputmode="decimal">
            <div style="font-size: 0.75rem; color: var(--text-sub); margin-top: 4px; text-align: right;">é¢„è®¡æ‰£é™¤: Â¥<span id="feePreview">0.00</span></div>
        </div>

        <!-- ç»“æœå±•ç¤º -->
        <div class="result-card" id="resultCard">
            <div class="metric-label">é¢„ä¼°å‡€åˆ©æ¶¦</div>
            <div class="main-profit" id="netProfit">0.00 <span>å…ƒ</span></div>
            
            <div class="sub-metrics">
                <div class="metric-item">
                    <div class="metric-label">åˆ©æ¶¦ç‡</div>
                    <div class="metric-value" id="margin">0%</div>
                </div>
                <div class="metric-item">
                    <div class="metric-label">ä¿æœ¬å”®ä»·</div>
                    <div class="metric-value" id="breakEven">0.00</div>
                </div>
                <div class="metric-item">
                    <div class="metric-label">æ€»æˆæœ¬</div>
                    <div class="metric-value" id="totalCost">0.00</div>
                </div>
            </div>
        </div>

        <button class="btn-reset" onclick="resetData()">â†º é‡ç½®æ‰€æœ‰æ•°æ®</button>
    </div>

    <script>
        const inputs = ['cost', 'price', 'shipping', 'misc', 'feeRate'];
        const els = {};
        inputs.forEach(id => els[id] = document.getElementById(id));
        
        const resEls = {
            netProfit: document.getElementById('netProfit'),
            margin: document.getElementById('margin'),
            breakEven: document.getElementById('breakEven'),
            totalCost: document.getElementById('totalCost'),
            feePreview: document.getElementById('feePreview'),
            resultCard: document.getElementById('resultCard')
        };

        // --- ä¸»é¢˜åˆ‡æ¢é€»è¾‘ ---
        const themeBtn = document.getElementById('themeBtn');
        
        // æ£€æŸ¥æœ¬åœ°å­˜å‚¨æ˜¯å¦æœ‰ä¿å­˜çš„ä¸»é¢˜
        const savedTheme = localStorage.getItem('profit_theme');
        if (savedTheme) {
            document.body.setAttribute('data-theme', savedTheme);
            themeBtn.innerText = savedTheme === 'dark' ? 'ğŸŒ™' : 'â˜€ï¸';
        } else if (window.matchMedia && window.matchMedia('(prefers-color-scheme: dark)').matches) {
            // å¦‚æœæ²¡æœ‰ä¿å­˜ï¼Œåˆ™è·Ÿéšç³»ç»Ÿ
            document.body.setAttribute('data-theme', 'dark');
            themeBtn.innerText = 'ğŸŒ™';
        }

        function toggleTheme() {
            const currentTheme = document.body.getAttribute('data-theme');
            const newTheme = currentTheme === 'dark' ? 'light' : 'dark';
            
            document.body.setAttribute('data-theme', newTheme);
            themeBtn.innerText = newTheme === 'dark' ? 'ğŸŒ™' : 'â˜€ï¸';
            
            // ä¿å­˜è®¾ç½®
            localStorage.setItem('profit_theme', newTheme);
        }

        // --- è®¡ç®—é€»è¾‘ ---
        function calculate() {
            const v = {};
            inputs.forEach(id => v[id] = parseFloat(els[id].value) || 0);

            // 1. å¹³å°è´¹ (æŒ‰å”®ä»·ç®—)
            const platformFee = v.price * (v.feeRate / 100);
            
            // 2. æ€»æˆæœ¬ (è¿›è´§ + è¿è´¹ + æ‚è´¹ + å¹³å°è´¹)
            const totalCost = v.cost + v.shipping + v.misc + platformFee;
            
            // 3. å‡€åˆ©æ¶¦
            const profit = v.price - totalCost;

            // 4. åˆ©æ¶¦ç‡
            let margin = 0;
            if (v.price > 0) {
                margin = (profit / v.price) * 100;
            }

            // 5. ä¿æœ¬å”®ä»·
            // å”®ä»· = å›ºå®šæˆæœ¬ / (1 - è´¹ç‡)
            const fixedCost = v.cost + v.shipping + v.misc;
            let breakEven = 0;
            if (v.feeRate < 100) {
                breakEven = fixedCost / (1 - (v.feeRate / 100));
            }

            updateUI(profit, margin, breakEven, totalCost, platformFee);
        }

        function updateUI(profit, margin, breakEven, totalCost, platformFee) {
            resEls.netProfit.innerHTML = profit.toFixed(2) + ' <span>å…ƒ</span>';
            resEls.margin.innerText = margin.toFixed(1) + '%';
            resEls.breakEven.innerText = breakEven.toFixed(2);
            resEls.totalCost.innerText = totalCost.toFixed(2);
            resEls.feePreview.innerText = platformFee.toFixed(2);

            resEls.netProfit.className = 'main-profit ' + (profit >= 0 ? 'text-green' : 'text-red');
            resEls.margin.className = 'metric-value ' + (profit >= 0 ? 'text-green' : 'text-red');

            // åŠ¨ç”»åé¦ˆ
            resEls.resultCard.classList.remove('pulse-green', 'pulse-red');
            void resEls.resultCard.offsetWidth; 
            if (profit !== 0 || totalCost !== 0) {
                resEls.resultCard.classList.add(profit >= 0 ? 'pulse-green' : 'pulse-red');
            }
        }

        // ç»‘å®šäº‹ä»¶
        inputs.forEach(id => {
            els[id].addEventListener('focus', function() { this.select(); });
            els[id].addEventListener('input', calculate);
        });

        function resetData() {
            inputs.forEach(id => {
                if(id === 'feeRate' || id === 'misc') {
                    els[id].value = '0'; 
                } else {
                    els[id].value = '';
                }
            });
            calculate();
            els.cost.focus(); // é‡ç½®åå…‰æ ‡å›åˆ°â€œè¿›è´§æˆæœ¬â€
        }

        calculate();
    </script>
</body>
</html>